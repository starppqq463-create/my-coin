<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>바이낸스 & 바이비트 BTC 가격 테스트</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #1e2329; color: #eaecef; padding: 20px; line-height: 1.6; }
        h1 { color: #f0b90b; border-bottom: 1px solid #3b4148; padding-bottom: 10px; }
        #results { border: 1px solid #3b4148; padding: 20px; border-radius: 8px; background-color: #13171a; }
        .item { margin-bottom: 12px; font-size: 18px; display: flex; align-items: center; }
        .label { font-weight: bold; color: #848e9c; min-width: 200px; display: inline-block; }
        .price { color: #14f195; font-family: monospace, monospace; font-size: 20px; }
        .error { color: #f6465d; }
        #status { margin-top: 20px; padding: 15px; font-size: 13px; color: #848e9c; white-space: pre-wrap; background-color: #13171a; border-radius: 8px; height: 150px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>바이낸스 & 바이비트 BTC 가격 테스트</h1>
    <p>이 페이지는 서버와 무관하게 현재 사용자의 브라우저에서 직접 API를 호출하여 결과를 보여줍니다.</p>
    <div id="results">
        <div class="item"><span class="label">바이낸스 (현물):</span> <span id="binance-spot">-</span></div>
        <div class="item"><span class="label">바이낸스 (선물):</span> <span id="binance-futures">-</span></div>
        <div class="item"><span class="label">바이비트 (현물):</span> <span id="bybit-spot">-</span></div>
        <div class="item"><span class="label">바이비트 (선물):</span> <span id="bybit-futures">-</span></div>
    </div>
    <pre id="status">테스트 시작...</pre>

    <script>
        const PROXY_URL = 'https://corsproxy.io/?';

        const binanceSpotEl = document.getElementById('binance-spot');
        const binanceFuturesEl = document.getElementById('binance-futures');
        const bybitSpotEl = document.getElementById('bybit-spot');
        const bybitFuturesEl = document.getElementById('bybit-futures');
        const statusEl = document.getElementById('status');

        function log(message) {
            console.log(message);
            statusEl.textContent += `\n[${new Date().toLocaleTimeString()}] ${message}`;
            statusEl.scrollTop = statusEl.scrollHeight;
        }

        async function fetchWithProxy(url) {
            const fullUrl = PROXY_URL + encodeURIComponent(url);
            log(`요청: ${url}`);
            try {
                const response = await fetch(fullUrl);
                if (!response.ok) {
                    throw new Error(`HTTP 에러! 상태: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                log(`에러 발생 (${url}): ${error.message}`);
                return null;
            }
        }

        async function testBinanceSpot() {
            const data = await fetchWithProxy('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
            if (data && data.lastPrice) {
                binanceSpotEl.textContent = `$${parseFloat(data.lastPrice).toLocaleString()}`;
                binanceSpotEl.classList.add('price');
                log('바이낸스 현물 성공');
            } else {
                binanceSpotEl.textContent = '실패';
                binanceSpotEl.classList.add('error');
            }
        }

        async function testBinanceFutures() {
            const data = await fetchWithProxy('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=BTCUSDT');
            if (data && data.lastPrice) {
                binanceFuturesEl.textContent = `$${parseFloat(data.lastPrice).toLocaleString()}`;
                binanceFuturesEl.classList.add('price');
                log('바이낸스 선물 성공');
            } else {
                binanceFuturesEl.textContent = '실패';
                binanceFuturesEl.classList.add('error');
            }
        }

        async function testBybitSpot() {
            const data = await fetchWithProxy('https://api.bybit.com/v5/market/tickers?category=spot&symbol=BTCUSDT');
            if (data && data.result && data.result.list && data.result.list[0]) {
                bybitSpotEl.textContent = `$${parseFloat(data.result.list[0].lastPrice).toLocaleString()}`;
                bybitSpotEl.classList.add('price');
                log('바이비트 현물 성공');
            } else {
                bybitSpotEl.textContent = '실패';
                bybitSpotEl.classList.add('error');
            }
        }

        async function testBybitFutures() {
            const data = await fetchWithProxy('https://api.bybit.com/v5/market/tickers?category=linear&symbol=BTCUSDT');
            if (data && data.result && data.result.list && data.result.list[0]) {
                bybitFuturesEl.textContent = `$${parseFloat(data.result.list[0].lastPrice).toLocaleString()}`;
                bybitFuturesEl.classList.add('price');
                log('바이비트 선물 성공');
            } else {
                bybitFuturesEl.textContent = '실패';
                bybitFuturesEl.classList.add('error');
            }
        }

        async function runAllTests() {
            await Promise.all([
                testBinanceSpot(),
                testBinanceFutures(),
                testBybitSpot(),
                testBybitFutures()
            ]);
            log('모든 테스트 완료.');
        }

        runAllTests();
    </script>
</body>
</html>